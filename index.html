<script>
const app = document.getElementById("app");
const blocked = document.getElementById("blocked");

const ua = navigator.userAgent;
const isApple = /iPhone|iPad|Macintosh/.test(ua) && !/Android/.test(ua);
const m = ua.match(/OS (\d+)[._](\d+)/);
const ios = m ? parseFloat(`${m[1]}.${m[2]}`) : null;

/* ---------- Block Non-Apple or Unsupported ---------- */

if (!isApple || !ios || ios < 14.3) {
  if (app) app.style.display = "none";
  if (blocked) blocked.style.display = "block";
}

/* ---------- Edition Support + Recommendation ---------- */

let best = null;
let bestMin = -1;

document.querySelectorAll(".edition-link").forEach(link => {
  const min = parseFloat(link.dataset.min || 0);
  const card = link.querySelector(".edition");
  if (!card) return;

  if (ios && ios < min) {
    link.classList.add("disabled");
    card.classList.add("unsupported");
  } 
  else if (ios && link.dataset.sky === "true" && min > bestMin) {
    bestMin = min;
    best = card;
  }
});

if (best) best.classList.add("recommended");

/* ---------- Dynamic Skylark e / Fe Jump Logic ---------- */

const jump = document.getElementById("jump-to-e");
const skylarkE = document.querySelector(".skylark-e");
const skylarkFe = document.querySelector(".skylark-fe");

if (jump && ios) {

  // iOS 14.3–14.8.1 → hide text completely
  if (ios >= 14.3 && ios <= 14.8) {
    jump.style.display = "none";
  }

  // iOS 15.0–17.7 → Skylark Fe
  else if (ios >= 15.0 && ios <= 17.7) {

    jump.textContent = "Don’t want to use Skylark Servers? Use Skylark Fe";

    jump.onclick = function(e) {
      e.preventDefault();
      if (!skylarkFe) return;
      skylarkFe.scrollIntoView({ behavior: "smooth", block: "center" });
      skylarkFe.classList.add("highlighted");
      setTimeout(() => skylarkFe.classList.remove("highlighted"), 2200);
    };

  }

  // iOS 18.0+ → Skylark e
  else if (ios >= 18.0) {

    jump.textContent = "Don’t want to use Skylark Servers? Use Skylark e";

    jump.onclick = function(e) {
      e.preventDefault();
      if (!skylarkE) return;
      skylarkE.scrollIntoView({ behavior: "smooth", block: "center" });
      skylarkE.classList.add("highlighted");
      setTimeout(() => skylarkE.classList.remove("highlighted"), 2200);
    };

  }

  else {
    jump.style.display = "none";
  }
}
</script>